<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="../_static/icon.png" sizes="1024x1024" rel="icon" type="image/png"><link rel="index" title="Index" href="../genindex.html"><link rel="search" title="Search" href="../search.html"><link rel="next" title="File gui.cuh" href="file_src_gui.cuh.html"><link rel="prev" title="File gui.cu" href="file_src_gui.cu.html">
        <link rel="prefetch" href="../_static/icon.png" as="image">

    <!-- Generated with Sphinx 8.2.3 and Furo 2025.09.25 -->
        <title>Program Listing for File gui.cu - REYN documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=580074bf" />
    <link rel="stylesheet" type="text/css" href="../_static/collapsible-lists/css/tree_view.css?v=a885cde7" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">REYN  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/icon.png" alt="Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="library_root.html">C++ Documentation</a><input aria-label="Toggle navigation of C++ Documentation" checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="structDeviceBuffer_1_1ExternallyManagedBuffer.html">Struct DeviceBuffer::ExternallyManagedBuffer</a></li>
<li class="toctree-l2"><a class="reference internal" href="structGUI_1_1DragState.html">Struct GUI::DragState</a></li>
<li class="toctree-l2"><a class="reference internal" href="structMaybeSorted.html">Template Struct MaybeSorted</a></li>
<li class="toctree-l2"><a class="reference internal" href="structMaybeSorted_3_01Resort_1_1no_01_4.html">Template Struct MaybeSorted&lt; Resort::no &gt;</a></li>
<li class="toctree-l2"><a class="reference internal" href="structMaybeSorted_3_01Resort_1_1yes_01_4.html">Template Struct MaybeSorted&lt; Resort::yes &gt;</a></li>
<li class="toctree-l2"><a class="reference internal" href="structUniformGrid.html">Template Struct UniformGrid</a></li>
<li class="toctree-l2"><a class="reference internal" href="classB3.html">Class B3</a></li>
<li class="toctree-l2"><a class="reference internal" href="classC2.html">Class C2</a></li>
<li class="toctree-l2"><a class="reference internal" href="classCOS.html">Class COS</a></li>
<li class="toctree-l2"><a class="reference internal" href="classDeviceBuffer.html">Template Class DeviceBuffer</a></li>
<li class="toctree-l2"><a class="reference internal" href="classGUI.html">Class GUI</a></li>
<li class="toctree-l2"><a class="reference internal" href="classKernel.html">Template Class Kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="classParticles.html">Class Particles</a></li>
<li class="toctree-l2"><a class="reference internal" href="classScene.html">Class Scene</a></li>
<li class="toctree-l2"><a class="reference internal" href="classSESPH.html">Template Class SESPH</a></li>
<li class="toctree-l2"><a class="reference internal" href="classUniformGridBuilder.html">Class UniformGridBuilder</a></li>
<li class="toctree-l2"><a class="reference internal" href="classW6.html">Class W6</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="file_src_buffer.cuh.html">File buffer.cuh</a><input aria-label="Toggle navigation of File buffer.cuh" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="program_listing_file_src_buffer.cuh.html">Program Listing for File buffer.cuh</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="file_src_common.h.html">File common.h</a><input aria-label="Toggle navigation of File common.h" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="program_listing_file_src_common.h.html">Program Listing for File common.h</a></li>
</ul>
</li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="file_src_gui.cu.html">File gui.cu</a><input aria-label="Toggle navigation of File gui.cu" checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul class="current">
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#">Program Listing for File gui.cu</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="file_src_gui.cuh.html">File gui.cuh</a><input aria-label="Toggle navigation of File gui.cuh" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="program_listing_file_src_gui.cuh.html">Program Listing for File gui.cuh</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="file_src_kernels.cu.html">File kernels.cu</a><input aria-label="Toggle navigation of File kernels.cu" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="program_listing_file_src_kernels.cu.html">Program Listing for File kernels.cu</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="file_src_kernels.cuh.html">File kernels.cuh</a><input aria-label="Toggle navigation of File kernels.cuh" class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="program_listing_file_src_kernels.cuh.html">Program Listing for File kernels.cuh</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="file_src_main.cu.html">File main.cu</a><input aria-label="Toggle navigation of File main.cu" class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="program_listing_file_src_main.cu.html">Program Listing for File main.cu</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="file_src_particles.cu.html">File particles.cu</a><input aria-label="Toggle navigation of File particles.cu" class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="program_listing_file_src_particles.cu.html">Program Listing for File particles.cu</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="file_src_particles.cuh.html">File particles.cuh</a><input aria-label="Toggle navigation of File particles.cuh" class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="program_listing_file_src_particles.cuh.html">Program Listing for File particles.cuh</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="file_src_scene.cu.html">File scene.cu</a><input aria-label="Toggle navigation of File scene.cu" class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="program_listing_file_src_scene.cu.html">Program Listing for File scene.cu</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="file_src_scene.cuh.html">File scene.cuh</a><input aria-label="Toggle navigation of File scene.cuh" class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="program_listing_file_src_scene.cuh.html">Program Listing for File scene.cuh</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="file_src_solvers_SESPH.cu.html">File SESPH.cu</a><input aria-label="Toggle navigation of File SESPH.cu" class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="program_listing_file_src_solvers_SESPH.cu.html">Program Listing for File SESPH.cu</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="file_src_solvers_SESPH.cuh.html">File SESPH.cuh</a><input aria-label="Toggle navigation of File SESPH.cuh" class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="program_listing_file_src_solvers_SESPH.cuh.html">Program Listing for File SESPH.cuh</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="file_src_datastructure_uniformgrid.cu.html">File uniformgrid.cu</a><input aria-label="Toggle navigation of File uniformgrid.cu" class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="program_listing_file_src_datastructure_uniformgrid.cu.html">Program Listing for File uniformgrid.cu</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="file_src_datastructure_uniformgrid.cuh.html">File uniformgrid.cuh</a><input aria-label="Toggle navigation of File uniformgrid.cuh" class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="program_listing_file_src_datastructure_uniformgrid.cuh.html">Program Listing for File uniformgrid.cuh</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="file_src_vector_helper.cuh.html">File vector_helper.cuh</a><input aria-label="Toggle navigation of File vector_helper.cuh" class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="program_listing_file_src_vector_helper.cuh.html">Program Listing for File vector_helper.cuh</a></li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/api/program_listing_file_src_gui.cu.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="program-listing-for-file-gui-cu">
<span id="program-listing-file-src-gui-cu"></span><h1>Program Listing for File gui.cu<a class="headerlink" href="#program-listing-for-file-gui-cu" title="Link to this heading">¶</a></h1>
<p>↰ <a class="reference internal" href="file_src_gui.cu.html#file-src-gui-cu"><span class="std std-ref">Return to documentation for file</span></a> (<code class="docutils literal notranslate"><span class="pre">src/gui.cu</span></code>)</p>
<div class="highlight-cuda notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gui.cuh&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;particles.cuh&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;scene.cuh&quot;</span>

<span class="c1">// constants</span>
<span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">FONT_PATH</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;res/JBM.ttf&quot;</span><span class="w"> </span><span class="p">};</span>

<span class="c1">// shaders</span>

<span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">VERTEX_SHADER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="s">&quot;GLSL(</span>
<span class="w">    </span><span class="cp">#version 330 core</span>
<span class="w">    </span><span class="n">layout</span><span class="w"> </span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="w">    </span><span class="n">layout</span><span class="w"> </span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="w">    </span><span class="n">layout</span><span class="w"> </span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">z</span><span class="p">;</span>
<span class="w">    </span><span class="n">layout</span><span class="w"> </span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">col</span><span class="p">;</span>
<span class="w">    </span><span class="n">uniform</span><span class="w"> </span><span class="n">mat4</span><span class="w"> </span><span class="n">view</span><span class="p">;</span><span class="w"> </span><span class="c1">// view matrix</span>
<span class="w">    </span><span class="n">uniform</span><span class="w"> </span><span class="n">mat4</span><span class="w"> </span><span class="n">proj</span><span class="p">;</span><span class="w"> </span><span class="c1">// projection matrix</span>
<span class="w">    </span><span class="n">uniform</span><span class="w"> </span><span class="n">vec2</span><span class="w"> </span><span class="n">viewport</span><span class="p">;</span><span class="w"> </span><span class="c1">// viewport size</span>
<span class="w">    </span><span class="n">uniform</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">radius</span><span class="p">;</span><span class="w"> </span><span class="c1">// particle radius</span>

<span class="w">    </span><span class="n">flat</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="n">vec4</span><span class="w"> </span><span class="n">centre_vs</span><span class="p">;</span>
<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">colour</span><span class="p">;</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// pass the colour vertex attribute through to the fragment shader</span>
<span class="w">        </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">col</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// compute the centre of the sphere in view space and clip space</span>
<span class="w">        </span><span class="n">centre_vs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">view</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">vec4</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<span class="w">        </span><span class="n">gl_Position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">proj</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">centre_vs</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// if the sphere is behind the camera, disregard it by setting point size to zero</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">dist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">centre_vs</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dist</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">gl_PointSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// compute the size of the sphere from the projection matrix, distance and</span>
<span class="w">        </span><span class="c1">// viewport height</span>
<span class="w">        </span><span class="c1">// https://stackoverflow.com/questions/907756/</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">size_pixels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">proj</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">radius</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">viewport</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">dist</span><span class="p">;</span>
<span class="w">        </span><span class="n">gl_PointSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">size_pixels</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">)</span><span class="n">GLSL</span><span class="s">&quot;;</span>

<span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">FRAGMENT_SHADER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="s">&quot;GLSL(</span>
<span class="w">    </span><span class="cp">#version 330 core</span>

<span class="w">    </span><span class="n">uniform</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">radius</span><span class="p">;</span><span class="w"> </span><span class="c1">// particle radius in world space</span>
<span class="w">    </span><span class="n">uniform</span><span class="w"> </span><span class="n">mat4</span><span class="w"> </span><span class="n">view</span><span class="p">;</span><span class="w"> </span><span class="c1">// view matrix</span>
<span class="w">    </span><span class="n">uniform</span><span class="w"> </span><span class="n">mat4</span><span class="w"> </span><span class="n">proj</span><span class="p">;</span><span class="w"> </span><span class="c1">// projection matrix</span>
<span class="w">    </span><span class="n">uniform</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">use_colour</span><span class="p">;</span><span class="w"> </span><span class="c1">// one if per-particle colours from aCol buffer should be used, 0 otherwise</span>
<span class="w">    </span><span class="n">uniform</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">colour_scale</span><span class="p">;</span><span class="w"> </span><span class="c1">// scale the colour scalar by this factor before mapping</span>
<span class="w">    </span><span class="n">uniform</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">colour_map_selector</span><span class="p">;</span><span class="w"> </span><span class="c1">// the colour map to use, where 0 is the default</span>

<span class="w">    </span><span class="n">flat</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">vec4</span><span class="w"> </span><span class="n">centre_vs</span><span class="p">;</span><span class="w"> </span><span class="c1">// view-space position of the centre of the particle</span>
<span class="w">    </span><span class="n">in</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">colour</span><span class="p">;</span>
<span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="n">vec4</span><span class="w"> </span><span class="n">FragColor</span><span class="p">;</span>

<span class="w">    </span><span class="n">vec3</span><span class="w"> </span><span class="nf">colour_map</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">x</span><span class="p">){</span>
<span class="w">        </span><span class="c1">// in this case, revert the input</span>
<span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clamp</span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">colour_scale</span><span class="p">,</span><span class="w"> </span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mf">1.</span><span class="p">);</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="p">;</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="p">;</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">colour_map_selector</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span>
<span class="w">            </span><span class="c1">//https://github.com/kbinani/colormap-shaders/blob/master/shaders/glsl/IDL_CB-RdYiBu.frag</span>
<span class="w">            </span><span class="c1">// red</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.09790863520700754</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">r</span><span class="o">=</span><span class="w"> </span><span class="mf">5.14512820512820E+02</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1.64641025641026E+02</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.2001887081633112</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">r</span><span class="o">=</span><span class="w"> </span><span class="mf">2.83195402298854E+02</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1.87288998357964E+02</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.3190117539655621</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">r</span><span class="o">=</span><span class="w"> </span><span class="mf">9.27301587301214E+01</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2.25417989417999E+02</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.500517389125164</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">r</span><span class="o">=</span><span class="w"> </span><span class="mf">255.0</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.6068377196788788</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">r</span><span class="o">=</span><span class="w"> </span><span class="mf">-3.04674876847379E+02</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">4.07495073891681E+02</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.9017468988895416</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">r</span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">1.55336390191951E+02</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">7.56394659038288E+02</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">6.24412733169483E+02</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">r</span><span class="o">=</span><span class="w"> </span><span class="mf">-1.88350769230735E+02</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2.38492307692292E+02</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="c1">//green</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.09638568758964539</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4.81427692307692E+02</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">4.61538461538488E-01</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.4987066686153412</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((((</span><span class="mf">3.25545903568267E+04</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">4.24067109461319E+04</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1.83751375886345E+04</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">3.19145329617892E+03</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">8.08315127034676E+02</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1.44611527812961E+01</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.6047312345537269</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.18449917898218E+02</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">3.14234811165860E+02</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.7067635953426361</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-2.70822112753102E+02</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">4.06379036672115E+02</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">-4.62308723214883E+02</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2.42936159122279E+02</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2.74203431802418E+02</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="c1">//blue</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.09982818011951204</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.64123076923076E+01</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">3.72646153846154E+01</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.2958717460833126</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.87014675052409E+02</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1.02508735150248E+01</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.4900527540014758</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4.65475113122167E+02</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">4.25505279034673E+01</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.6017014681258838</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5.61032967032998E+02</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">8.93789173789407E+01</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.7015737100463595</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.51655677655728E+02</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">3.39446886446912E+02</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.8237156500567735</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-2.43405347593559E+02</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">4.03816042780725E+02</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-3.00296889157305E+02</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">4.50678495922638E+02</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>

<span class="w">            </span><span class="c1">// https://github.com/kbinani/colormap-shaders/blob/master/shaders/glsl/IDL_CB-Spectral.frag</span>
<span class="w">            </span><span class="c1">// red</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.09752005946586478</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5.63203907203907E+02</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1.57952380952381E+02</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.2005235116443438</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3.02650769230760E+02</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1.83361538461540E+02</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.2974133397506856</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">9.21045429665647E+01</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2.25581007115501E+02</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.5003919130598823</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">9.84288115246108E+00</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2.50046722689075E+02</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.5989021956920624</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-2.48619704433547E+02</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">3.79379310344861E+02</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.902860552072525</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="mf">2.76764884219295E+03</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">6.08393126459837E+03</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">3.80008072407485E+03</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">4.57725185424742E+02</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4.27603478260530E+02</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">3.35293188405479E+02</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="c1">// green</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.09785836420571035</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">6.23754529914529E+02</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">7.26495726495790E-01</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.2034012006283468</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4.60453201970444E+02</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1.67068965517242E+01</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.302409765476316</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">6.61789401709441E+02</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">2.42451282051364E+01</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.4005965758690823</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4.82379130434784E+02</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">3.00102898550747E+01</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.4981907026473237</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3.24710622710631E+02</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">9.31717541717582E+01</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.6064345916502067</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-9.64699507389807E+01</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">3.03000000000023E+02</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.7987472620841592</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-2.54022986425337E+02</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">3.98545610859729E+02</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-5.71281628959223E+02</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">6.51955082956207E+02</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="c1">// blue</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0997359608740309</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.26522393162393E+02</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">6.65042735042735E+01</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.1983790695667267</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.22037851037851E+02</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">9.12946682946686E+01</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.4997643530368805</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">5.39336225400169E+02</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">3.55461986381562E+01</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">3.88081126069087E+01</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.6025972254407099</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-3.79294261294313E+02</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">3.80837606837633E+02</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.6990141388105746</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.15990231990252E+02</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">8.23805453805459E+01</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.8032653181119567</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.68464957265204E+01</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1.51683418803401E+02</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.9035796343050095</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.40199023199020E+02</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">2.77279202279061E+01</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-2.78813846153774E+02</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">4.41241538461485E+02</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">};</span>


<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">clamp</span><span class="p">(</span><span class="n">vec3</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">255.</span><span class="p">,</span><span class="w"> </span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mf">1.</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>


<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// rescale fragment coordinate to [-1;1]^2</span>
<span class="w">        </span><span class="n">vec2</span><span class="w"> </span><span class="n">coord</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gl_PointCoord</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2.</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1.</span><span class="p">;</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">length_squared</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dot</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span><span class="w"> </span><span class="n">coord</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// discard fragments outside a circle</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">length_squared</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">1.</span><span class="p">)</span><span class="w"> </span><span class="n">discard</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// calculate the normal in view space</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">length_squared</span><span class="p">);</span>
<span class="w">        </span><span class="n">vec3</span><span class="w"> </span><span class="n">normal_vs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vec3</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// calculate the position of the fragment view space</span>
<span class="w">        </span><span class="n">vec3</span><span class="w"> </span><span class="n">frag_pos_vs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">centre_vs</span><span class="p">.</span><span class="n">xyz</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">normal_vs</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">radius</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// then project to clip space to obtain correct depth</span>
<span class="w">        </span><span class="n">vec4</span><span class="w"> </span><span class="n">frag_pos_cs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">proj</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">vec4</span><span class="p">(</span><span class="n">frag_pos_vs</span><span class="p">,</span><span class="w"> </span><span class="mf">1.</span><span class="p">);</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">z_cs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">frag_pos_cs</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">frag_pos_cs</span><span class="p">.</span><span class="n">w</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// remap depth from [-1;1] to [0;1] and write to depth buffer</span>
<span class="w">        </span><span class="n">gl_FragDepth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">z_cs</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// shading</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">diffuse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">normal_vs</span><span class="p">).</span><span class="n">z</span><span class="p">);</span>
<span class="w">        </span><span class="n">vec3</span><span class="w"> </span><span class="n">albedo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="p">(</span><span class="n">use_colour</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">?</span>
<span class="w">            </span><span class="n">colour_map</span><span class="p">(</span><span class="n">colour</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w">       </span><span class="c1">// if using per-particle colours</span>
<span class="w">            </span><span class="n">normalize</span><span class="p">(</span><span class="n">vec3</span><span class="p">(</span><span class="mf">135.</span><span class="p">,</span><span class="mf">206.</span><span class="p">,</span><span class="mf">250.</span><span class="p">))</span><span class="w"> </span><span class="c1">// default colour</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">        </span><span class="c1">// FragColor = vec4(albedo * max(.3, diffuse), 1.0);</span>
<span class="w">        </span><span class="n">FragColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vec4</span><span class="p">(</span><span class="n">albedo</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">diffuse</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// vec3 light_vs = normalize((view * vec4(normalize(-light_dir), 0.0)).xyz);</span>
<span class="w">        </span><span class="c1">// float lambertian = max(0.0, dot(normal_vs, light_vs));</span>
<span class="w">        </span><span class="c1">// vec3 view_dir = normalize(-frag_pos_vs); // camera at origin in view-space</span>
<span class="w">        </span><span class="c1">// vec3 reflect_dir = reflect(-light_vs, normal_vs);</span>
<span class="w">        </span><span class="c1">// float spec = pow(max(0.0, dot(view_dir, reflect_dir)), 64.0); // shininess is exponent</span>
<span class="w">        </span><span class="c1">// vec3 albedo = normalize(vec3(135.,206.,250.));</span>
<span class="w">        </span><span class="c1">// vec3 ambient = 0.5 * albedo;</span>
<span class="w">        </span><span class="c1">// vec3 color = ambient + (0.9 * lambertian) * albedo + 0.6 * spec;</span>
<span class="w">        </span><span class="c1">// FragColor = vec4(color, 1.0);</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">)</span><span class="n">GLSL</span><span class="s">&quot;;</span>

<span class="c1">// OpenGL helper functions</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">_opengl_check_compile</span><span class="p">(</span><span class="n">GLuint</span><span class="w"> </span><span class="n">shader</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">message</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">success</span><span class="p">;</span>
<span class="w">    </span><span class="n">glGetShaderiv</span><span class="p">(</span><span class="n">shader</span><span class="p">,</span><span class="w"> </span><span class="n">GL_COMPILE_STATUS</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">success</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">success</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">char</span><span class="w"> </span><span class="n">log</span><span class="p">[</span><span class="mi">512</span><span class="p">];</span>
<span class="w">        </span><span class="n">glGetShaderInfoLog</span><span class="p">(</span><span class="n">shader</span><span class="p">,</span><span class="w"> </span><span class="mi">512</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">log</span><span class="p">);</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">log</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">_opengl_check_link</span><span class="p">(</span><span class="n">GLuint</span><span class="w"> </span><span class="n">program</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">message</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">success</span><span class="p">;</span>
<span class="w">    </span><span class="n">glGetProgramiv</span><span class="p">(</span><span class="n">program</span><span class="p">,</span><span class="w"> </span><span class="n">GL_LINK_STATUS</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">success</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">success</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">char</span><span class="w"> </span><span class="n">log</span><span class="p">[</span><span class="mi">512</span><span class="p">];</span>
<span class="w">        </span><span class="n">glGetProgramInfoLog</span><span class="p">(</span><span class="n">program</span><span class="p">,</span><span class="w"> </span><span class="mi">512</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">log</span><span class="p">);</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">log</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="n">GLuint</span><span class="w"> </span><span class="nf">GUI::compile_shader</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// compile the shaders, checking for errors</span>
<span class="w">    </span><span class="n">GLuint</span><span class="w"> </span><span class="n">vert_shader</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">glCreateShader</span><span class="p">(</span><span class="n">GL_VERTEX_SHADER</span><span class="p">)</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="n">glShaderSource</span><span class="p">(</span><span class="n">vert_shader</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">VERTEX_SHADER</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">    </span><span class="n">glCompileShader</span><span class="p">(</span><span class="n">vert_shader</span><span class="p">);</span>
<span class="w">    </span><span class="n">_opengl_check_compile</span><span class="p">(</span><span class="n">vert_shader</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Vertex shader compilation failed:&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">GLuint</span><span class="w"> </span><span class="n">frag_shader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glCreateShader</span><span class="p">(</span><span class="n">GL_FRAGMENT_SHADER</span><span class="p">);</span>
<span class="w">    </span><span class="n">glShaderSource</span><span class="p">(</span><span class="n">frag_shader</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">FRAGMENT_SHADER</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">    </span><span class="n">glCompileShader</span><span class="p">(</span><span class="n">frag_shader</span><span class="p">);</span>
<span class="w">    </span><span class="n">_opengl_check_compile</span><span class="p">(</span><span class="n">frag_shader</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Fragment shader compilation failed:&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// build program from vertex and fragment shaders</span>
<span class="w">    </span><span class="n">GLuint</span><span class="w"> </span><span class="n">program</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glCreateProgram</span><span class="p">();</span>
<span class="w">    </span><span class="n">glAttachShader</span><span class="p">(</span><span class="n">program</span><span class="p">,</span><span class="w"> </span><span class="n">vert_shader</span><span class="p">);</span>
<span class="w">    </span><span class="n">glAttachShader</span><span class="p">(</span><span class="n">program</span><span class="p">,</span><span class="w"> </span><span class="n">frag_shader</span><span class="p">);</span>
<span class="w">    </span><span class="n">glLinkProgram</span><span class="p">(</span><span class="n">program</span><span class="p">);</span>
<span class="w">    </span><span class="n">_opengl_check_link</span><span class="p">(</span><span class="n">program</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Shader program linking failed:&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// delete shaders, return the program id</span>
<span class="w">    </span><span class="n">glDeleteShader</span><span class="p">(</span><span class="n">vert_shader</span><span class="p">);</span>
<span class="w">    </span><span class="n">glDeleteShader</span><span class="p">(</span><span class="n">frag_shader</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">program</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">GUI::_update_proj</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">proj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">perspective</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">radians</span><span class="p">(</span><span class="n">fov</span><span class="p">),</span><span class="w"> </span><span class="c1">// fov</span>
<span class="w">        </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">_window_width</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">_window_height</span><span class="p">,</span><span class="w"> </span><span class="c1">// aspect ratio</span>
<span class="w">        </span><span class="mf">1e-3f</span><span class="p">,</span><span class="w"> </span><span class="c1">// near plane</span>
<span class="w">        </span><span class="mf">1e3f</span><span class="w"> </span><span class="c1">// far plane</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">};</span>

<span class="kt">float</span><span class="w"> </span><span class="nf">wrap_around</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">val</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">lower</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">upper</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">val</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">upper</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">val</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">upper</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">lower</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">val</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">lower</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">val</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">upper</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">lower</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">val</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">GUI::update_view</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// https://learnopengl.com/Getting-started/Camera</span>
<span class="w">    </span><span class="c1">// compute camera position and view direction from spherical coordinates,</span>
<span class="w">    </span><span class="c1">// wrapping overflowing values around</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">theta_cur</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">wrap_around</span><span class="p">(</span><span class="n">theta</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">d_theta</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">M_PI</span><span class="p">)</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">phi_cur</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">wrap_around</span><span class="p">(</span><span class="n">phi</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">d_phi</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="p">)</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">radius</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">radius_init</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_radius_scroll_factor</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">camera_position</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span>
<span class="w">        </span><span class="n">radius</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sinf</span><span class="p">(</span><span class="n">theta_cur</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cosf</span><span class="p">(</span><span class="n">phi_cur</span><span class="p">),</span><span class="w"> </span><span class="n">radius</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cosf</span><span class="p">(</span><span class="n">theta_cur</span><span class="p">),</span>
<span class="w">        </span><span class="n">radius</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sinf</span><span class="p">(</span><span class="n">theta_cur</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sinf</span><span class="p">(</span><span class="n">phi_cur</span><span class="p">))</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">camera_dir_rev</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">camera_position</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">camera_target</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="c1">// standard up direction is positive y</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">world_up</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.f</span><span class="p">)</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="c1">// compute the up and right unit vectors with respect to the cameras view</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">right</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">cross</span><span class="p">(</span><span class="n">world_up</span><span class="p">,</span><span class="w"> </span><span class="n">camera_dir_rev</span><span class="p">);</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">normalize</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">cross</span><span class="p">(</span><span class="n">camera_dir_rev</span><span class="p">,</span><span class="w"> </span><span class="n">right</span><span class="p">))</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="c1">// add result of current right click drag to camera offset</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">offset_right</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0.f</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">offset_up</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0.f</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">camera_offset</span>
<span class="w">            </span><span class="o">+=</span><span class="w"> </span><span class="n">offset_right</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">normalize</span><span class="p">(</span><span class="n">right</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">offset_up</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">world_up</span><span class="p">;</span>
<span class="w">        </span><span class="n">offset_right</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.f</span><span class="p">;</span>
<span class="w">        </span><span class="n">offset_up</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.f</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">camera_offset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">d_right</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">normalize</span><span class="p">(</span><span class="n">right</span><span class="p">)</span>
<span class="w">        </span><span class="o">+</span><span class="w"> </span><span class="n">d_up</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">world_up</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="c1">// update the view matrix using the `glm::lookAt` function</span>
<span class="w">    </span><span class="n">view</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">lookAt</span><span class="p">(</span><span class="n">camera_position</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">offset</span><span class="p">,</span><span class="w"> </span><span class="n">camera_target</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">offset</span><span class="p">,</span><span class="w"> </span><span class="n">up</span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// CALLBACKS</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">framebuffer_size_callback</span><span class="p">(</span><span class="n">GLFWwindow</span><span class="o">*</span><span class="w"> </span><span class="n">window</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">height</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">gui</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">GUI</span><span class="o">*</span><span class="p">)</span><span class="n">glfwGetWindowUserPointer</span><span class="p">(</span><span class="n">window</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">gui</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">gui</span><span class="o">-&gt;</span><span class="n">_window_width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">width</span><span class="p">;</span>
<span class="w">        </span><span class="n">gui</span><span class="o">-&gt;</span><span class="n">_window_height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">height</span><span class="p">;</span>
<span class="w">        </span><span class="n">gui</span><span class="o">-&gt;</span><span class="n">_update_proj</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">glViewport</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">);</span>
<span class="p">};</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">scroll_callback</span><span class="p">(</span><span class="n">GLFWwindow</span><span class="o">*</span><span class="w"> </span><span class="n">window</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">xoffset</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">yoffset</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">gui</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">GUI</span><span class="o">*</span><span class="p">)</span><span class="n">glfwGetWindowUserPointer</span><span class="p">(</span><span class="n">window</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">gui</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">gui</span><span class="o">-&gt;</span><span class="n">_radius_scroll_factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">clamp</span><span class="p">(</span><span class="n">gui</span><span class="o">-&gt;</span><span class="n">_radius_scroll_factor</span>
<span class="w">                </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">yoffset</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">gui</span><span class="o">-&gt;</span><span class="n">_scroll_speed</span><span class="p">),</span>
<span class="w">            </span><span class="mf">0.01f</span><span class="p">,</span><span class="w"> </span><span class="mf">100.f</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// update the camera</span>
<span class="w">        </span><span class="n">gui</span><span class="o">-&gt;</span><span class="n">update_view</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">GUI::glfw_process_input</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// update current window size</span>
<span class="w">    </span><span class="n">glfwGetFramebufferSize</span><span class="p">(</span><span class="n">window</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">_window_width</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">_window_height</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// only react to cursor events if window is focused</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">glfwGetWindowAttrib</span><span class="p">(</span><span class="n">window</span><span class="p">,</span><span class="w"> </span><span class="n">GLFW_FOCUSED</span><span class="p">)</span>
<span class="w">        </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">glfwGetWindowAttrib</span><span class="p">(</span><span class="n">window</span><span class="p">,</span><span class="w"> </span><span class="n">GLFW_FOCUSED</span><span class="p">)</span>
<span class="w">        </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">ImGui</span><span class="o">::</span><span class="n">GetIO</span><span class="p">().</span><span class="n">WantCaptureMouse</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// query normalized cursor position in [0.0; 1.0] x [0.0; 1.0]</span>
<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">xpos</span><span class="p">,</span><span class="w"> </span><span class="n">ypos</span><span class="p">;</span>
<span class="w">        </span><span class="n">glfwGetCursorPos</span><span class="p">(</span><span class="n">window</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">xpos</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ypos</span><span class="p">);</span>
<span class="w">        </span><span class="n">xpos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">clamp</span><span class="p">(</span><span class="n">xpos</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">_window_width</span><span class="p">,</span><span class="w"> </span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mf">1.</span><span class="p">);</span>
<span class="w">        </span><span class="n">ypos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">clamp</span><span class="p">(</span><span class="n">ypos</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">_window_height</span><span class="p">,</span><span class="w"> </span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mf">1.</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// query cursor state and update camera</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">camera_needs_update</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="p">};</span>

<span class="w">        </span><span class="c1">// adjust viewing angle if dragging left mouse button</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">left_pressed</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">glfwGetMouseButton</span><span class="p">(</span><span class="n">window</span><span class="p">,</span><span class="w"> </span><span class="n">GLFW_MOUSE_BUTTON_LEFT</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">GLFW_PRESS</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">        </span><span class="n">left_drag</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">left_pressed</span><span class="p">,</span><span class="w"> </span><span class="n">xpos</span><span class="p">,</span><span class="w"> </span><span class="n">d_phi</span><span class="p">,</span><span class="w"> </span><span class="mf">-2.f</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="p">,</span><span class="w"> </span><span class="n">phi</span><span class="p">,</span><span class="w"> </span><span class="n">ypos</span><span class="p">,</span>
<span class="w">            </span><span class="n">d_theta</span><span class="p">,</span><span class="w"> </span><span class="n">M_PI</span><span class="p">,</span><span class="w"> </span><span class="n">theta</span><span class="p">,</span><span class="w"> </span><span class="n">camera_needs_update</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// adjust camera and target position if dragging right mouse button</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">right_pressed</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">glfwGetMouseButton</span><span class="p">(</span><span class="n">window</span><span class="p">,</span><span class="w"> </span><span class="n">GLFW_MOUSE_BUTTON_RIGHT</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">GLFW_PRESS</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">        </span><span class="n">right_drag</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">right_pressed</span><span class="p">,</span><span class="w"> </span><span class="n">xpos</span><span class="p">,</span><span class="w"> </span><span class="n">d_right</span><span class="p">,</span><span class="w"> </span><span class="mf">1.</span><span class="p">,</span><span class="w"> </span><span class="n">offset_right</span><span class="p">,</span><span class="w"> </span><span class="n">ypos</span><span class="p">,</span>
<span class="w">            </span><span class="n">d_up</span><span class="p">,</span><span class="w"> </span><span class="mf">1.</span><span class="p">,</span><span class="w"> </span><span class="n">offset_up</span><span class="p">,</span><span class="w"> </span><span class="n">camera_needs_update</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// if the camera was changed in any way, recompute the view matrix and</span>
<span class="w">        </span><span class="c1">// update `view`</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">camera_needs_update</span><span class="p">)</span>
<span class="w">            </span><span class="n">update_view</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>

<span class="c1">// QUERY WHETHER CLOSE WAS REQUESTED</span>

<span class="c1">// CONSTRUCTOR</span>

<span class="n">GUI</span><span class="o">::</span><span class="n">GUI</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">init_w</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">init_h</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">enable_vsync</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">target_fps</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// save parameters</span>
<span class="w">    </span><span class="n">this</span><span class="o">-&gt;</span><span class="n">_window_width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">init_w</span><span class="p">;</span>
<span class="w">    </span><span class="n">this</span><span class="o">-&gt;</span><span class="n">_window_height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">init_h</span><span class="p">;</span>
<span class="w">    </span><span class="n">this</span><span class="o">-&gt;</span><span class="n">_window_height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">init_h</span><span class="p">;</span>
<span class="w">    </span><span class="n">this</span><span class="o">-&gt;</span><span class="n">target_fps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">target_fps</span><span class="p">;</span>
<span class="w">    </span><span class="n">_update_proj</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// initialize GLFW with the OpenGL version 3.3</span>
<span class="w">    </span><span class="n">glfwInit</span><span class="p">();</span>
<span class="w">    </span><span class="n">glfwWindowHint</span><span class="p">(</span><span class="n">GLFW_CONTEXT_VERSION_MAJOR</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>
<span class="w">    </span><span class="n">glfwWindowHint</span><span class="p">(</span><span class="n">GLFW_CONTEXT_VERSION_MINOR</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>
<span class="w">    </span><span class="n">glfwWindowHint</span><span class="p">(</span><span class="n">GLFW_OPENGL_PROFILE</span><span class="p">,</span><span class="w"> </span><span class="n">GLFW_OPENGL_CORE_PROFILE</span><span class="p">);</span>
<span class="w">    </span><span class="n">glfwWindowHint</span><span class="p">(</span><span class="n">GLFW_OPENGL_FORWARD_COMPAT</span><span class="p">,</span><span class="w"> </span><span class="n">GL_TRUE</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// create a window</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">main_scale</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">ImGui_ImplGlfw_GetContentScaleForMonitor</span><span class="p">(</span>
<span class="w">        </span><span class="n">glfwGetPrimaryMonitor</span><span class="p">())</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="n">this</span><span class="o">-&gt;</span><span class="n">window</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glfwCreateWindow</span><span class="p">((</span><span class="kt">int</span><span class="p">)(</span><span class="n">init_w</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">main_scale</span><span class="p">),</span>
<span class="w">        </span><span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">init_h</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">main_scale</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;REYN&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">window</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">glfwTerminate</span><span class="p">();</span>
<span class="w">        </span><span class="n">throw</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;Failed to create GLFW window&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// set current context</span>
<span class="w">    </span><span class="n">glfwMakeContextCurrent</span><span class="p">(</span><span class="n">window</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// set update interval: 1 is vsync, 0 as as fast as possible</span>
<span class="w">    </span><span class="n">glfwSwapInterval</span><span class="p">(</span><span class="n">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">enable_vsync</span><span class="p">));</span>
<span class="w">    </span><span class="c1">// save the pointer to this gui object in the window instance for access via</span>
<span class="w">    </span><span class="c1">// `glfwGetWindowUserPointer` in callbacks</span>
<span class="w">    </span><span class="n">glfwSetWindowUserPointer</span><span class="p">(</span><span class="n">window</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)(</span><span class="n">this</span><span class="p">));</span>
<span class="w">    </span><span class="c1">// set callbacks for resizeing and scrolling</span>
<span class="w">    </span><span class="n">glfwSetFramebufferSizeCallback</span><span class="p">(</span><span class="n">window</span><span class="p">,</span><span class="w"> </span><span class="n">framebuffer_size_callback</span><span class="p">);</span>
<span class="w">    </span><span class="n">glfwSetScrollCallback</span><span class="p">(</span><span class="n">window</span><span class="p">,</span><span class="w"> </span><span class="n">scroll_callback</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// maximize the window</span>
<span class="w">    </span><span class="n">glfwMaximizeWindow</span><span class="p">(</span><span class="n">window</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// SET UP IMGUI</span>
<span class="w">    </span><span class="n">IMGUI_CHECKVERSION</span><span class="p">();</span>
<span class="w">    </span><span class="n">ImGui</span><span class="o">::</span><span class="n">CreateContext</span><span class="p">();</span>
<span class="w">    </span><span class="n">this</span><span class="o">-&gt;</span><span class="n">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ImGui</span><span class="o">::</span><span class="n">GetIO</span><span class="p">();</span>
<span class="w">    </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">io</span><span class="p">;</span>
<span class="w">    </span><span class="n">io</span><span class="o">-&gt;</span><span class="n">ConfigFlags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">ImGuiConfigFlags_NavEnableKeyboard</span><span class="p">;</span><span class="w"> </span><span class="c1">// keyboard controls</span>
<span class="w">    </span><span class="n">io</span><span class="o">-&gt;</span><span class="n">ConfigFlags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">ImGuiConfigFlags_NavEnableGamepad</span><span class="p">;</span><span class="w"> </span><span class="c1">// gamepad controls</span>
<span class="w">    </span><span class="n">io</span><span class="o">-&gt;</span><span class="n">ConfigFlags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">ImGuiConfigFlags_DockingEnable</span><span class="p">;</span><span class="w"> </span><span class="c1">// enable docking</span>
<span class="w">    </span><span class="n">io</span><span class="o">-&gt;</span><span class="n">ConfigFlags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">ImGuiConfigFlags_ViewportsEnable</span><span class="p">;</span><span class="w"> </span><span class="c1">// multi viewport</span>
<span class="w">    </span><span class="c1">// set style</span>
<span class="w">    </span><span class="n">ImGui</span><span class="o">::</span><span class="n">StyleColorsDark</span><span class="p">();</span>
<span class="w">    </span><span class="n">ImGuiStyle</span><span class="o">&amp;</span><span class="w"> </span><span class="n">style</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ImGui</span><span class="o">::</span><span class="n">GetStyle</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// manage scaling and viewports</span>
<span class="w">    </span><span class="n">style</span><span class="p">.</span><span class="n">ScaleAllSizes</span><span class="p">(</span><span class="n">main_scale</span><span class="p">);</span>
<span class="w">    </span><span class="n">style</span><span class="p">.</span><span class="n">FontScaleDpi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">main_scale</span><span class="p">;</span>
<span class="w">    </span><span class="n">io</span><span class="o">-&gt;</span><span class="n">ConfigDpiScaleFonts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="n">io</span><span class="o">-&gt;</span><span class="n">ConfigDpiScaleViewports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">ConfigFlags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">ImGuiConfigFlags_ViewportsEnable</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">style</span><span class="p">.</span><span class="n">WindowRounding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">;</span>
<span class="w">        </span><span class="n">style</span><span class="p">.</span><span class="n">Colors</span><span class="p">[</span><span class="n">ImGuiCol_WindowBg</span><span class="p">].</span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// load font</span>
<span class="w">    </span><span class="n">style</span><span class="p">.</span><span class="n">FontSizeBase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">16.0f</span><span class="p">;</span>
<span class="w">    </span><span class="n">io</span><span class="o">-&gt;</span><span class="n">Fonts</span><span class="o">-&gt;</span><span class="n">AddFontDefault</span><span class="p">();</span>
<span class="w">    </span><span class="n">font</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">io</span><span class="o">-&gt;</span><span class="n">Fonts</span><span class="o">-&gt;</span><span class="n">AddFontFromFileTTF</span><span class="p">(</span><span class="n">FONT_PATH</span><span class="p">,</span><span class="w"> </span><span class="n">style</span><span class="p">.</span><span class="n">FontSizeBase</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// initialize ImGui</span>
<span class="w">    </span><span class="n">ImGui_ImplGlfw_InitForOpenGL</span><span class="p">(</span><span class="n">window</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<span class="w">    </span><span class="n">ImGui_ImplOpenGL3_Init</span><span class="p">(</span><span class="s">&quot;#version 150&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// set up glad</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">gladLoadGLLoader</span><span class="p">((</span><span class="n">GLADloadproc</span><span class="p">)</span><span class="n">glfwGetProcAddress</span><span class="p">))</span>
<span class="w">        </span><span class="n">throw</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;Failed to initialize GLAD&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// set clear colour and initial viewport</span>
<span class="w">    </span><span class="n">glViewport</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">init_w</span><span class="p">,</span><span class="w"> </span><span class="n">init_h</span><span class="p">);</span>
<span class="w">    </span><span class="n">glClearColor</span><span class="p">(</span><span class="mf">0.1f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// enable point rendering features</span>
<span class="w">    </span><span class="n">glEnable</span><span class="p">(</span><span class="n">GL_PROGRAM_POINT_SIZE</span><span class="p">);</span><span class="w"> </span><span class="c1">// enable varying, programmable point sizes</span>
<span class="w">    </span><span class="n">glEnable</span><span class="p">(</span><span class="n">GL_DEPTH_TEST</span><span class="p">);</span><span class="w"> </span><span class="c1">// enable depth testing</span>

<span class="w">    </span><span class="c1">// create shader program</span>
<span class="w">    </span><span class="n">shader_program</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compile_shader</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// trigger the initial computation of the view matrix representing the</span>
<span class="w">    </span><span class="c1">// camera this is recomputed on-demand in the `glfw_process_input` function</span>
<span class="w">    </span><span class="c1">// whenever the camera is adjusted through user input</span>
<span class="w">    </span><span class="n">update_view</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// create a buffer and register it for use with CUDA</span>
<span class="w">    </span><span class="n">create_and_register_buffers</span><span class="p">(</span><span class="n">N</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// start a timer in another thread that periodically sets an atomic bool to</span>
<span class="w">    </span><span class="c1">// true to signal the main thread to update and render the GUI at the target</span>
<span class="w">    </span><span class="c1">// FPS</span>
<span class="w">    </span><span class="n">timer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="p">([</span><span class="n">this</span><span class="p">]()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">wait_time</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="n">s</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">this</span><span class="o">-&gt;</span><span class="n">target_fps</span><span class="w"> </span><span class="p">};</span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">exit_requested</span><span class="p">.</span><span class="n">load</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">should_render</span><span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">(</span><span class="n">wait_time</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="n">GUI</span><span class="o">::</span><span class="n">create_and_register_buffers</span><span class="p">(</span><span class="n">uint</span><span class="w"> </span><span class="n">N</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// create VBO for positions</span>
<span class="w">    </span><span class="n">glGenBuffers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x_vbo</span><span class="p">);</span>
<span class="w">    </span><span class="n">glBindBuffer</span><span class="p">(</span><span class="n">GL_ARRAY_BUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">x_vbo</span><span class="p">);</span>
<span class="w">    </span><span class="n">glBufferData</span><span class="p">(</span><span class="n">GL_ARRAY_BUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">),</span><span class="w"> </span><span class="n">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DYNAMIC_DRAW</span><span class="p">);</span>
<span class="w">    </span><span class="n">glGenBuffers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">y_vbo</span><span class="p">);</span>
<span class="w">    </span><span class="n">glBindBuffer</span><span class="p">(</span><span class="n">GL_ARRAY_BUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">y_vbo</span><span class="p">);</span>
<span class="w">    </span><span class="n">glBufferData</span><span class="p">(</span><span class="n">GL_ARRAY_BUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">),</span><span class="w"> </span><span class="n">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DYNAMIC_DRAW</span><span class="p">);</span>
<span class="w">    </span><span class="n">glGenBuffers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">z_vbo</span><span class="p">);</span>
<span class="w">    </span><span class="n">glBindBuffer</span><span class="p">(</span><span class="n">GL_ARRAY_BUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">z_vbo</span><span class="p">);</span>
<span class="w">    </span><span class="n">glBufferData</span><span class="p">(</span><span class="n">GL_ARRAY_BUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">),</span><span class="w"> </span><span class="n">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DYNAMIC_DRAW</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// create vbo for colours</span>
<span class="w">    </span><span class="n">glGenBuffers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">col_vbo</span><span class="p">);</span>
<span class="w">    </span><span class="n">glBindBuffer</span><span class="p">(</span><span class="n">GL_ARRAY_BUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">col_vbo</span><span class="p">);</span>
<span class="w">    </span><span class="n">glBufferData</span><span class="p">(</span><span class="n">GL_ARRAY_BUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">),</span><span class="w"> </span><span class="n">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">GL_DYNAMIC_DRAW</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// expose VBOs to CUDA</span>
<span class="w">    </span><span class="n">CUDA_CHECK</span><span class="p">(</span><span class="n">cudaGraphicsGLRegisterBuffer</span><span class="p">(</span>
<span class="w">        </span><span class="o">&amp;</span><span class="n">cuda_x_vbo_resource</span><span class="p">,</span><span class="w"> </span><span class="n">x_vbo</span><span class="p">,</span><span class="w"> </span><span class="n">cudaGraphicsMapFlagsWriteDiscard</span><span class="p">));</span>
<span class="w">    </span><span class="n">CUDA_CHECK</span><span class="p">(</span><span class="n">cudaGraphicsGLRegisterBuffer</span><span class="p">(</span>
<span class="w">        </span><span class="o">&amp;</span><span class="n">cuda_y_vbo_resource</span><span class="p">,</span><span class="w"> </span><span class="n">y_vbo</span><span class="p">,</span><span class="w"> </span><span class="n">cudaGraphicsMapFlagsWriteDiscard</span><span class="p">));</span>
<span class="w">    </span><span class="n">CUDA_CHECK</span><span class="p">(</span><span class="n">cudaGraphicsGLRegisterBuffer</span><span class="p">(</span>
<span class="w">        </span><span class="o">&amp;</span><span class="n">cuda_z_vbo_resource</span><span class="p">,</span><span class="w"> </span><span class="n">z_vbo</span><span class="p">,</span><span class="w"> </span><span class="n">cudaGraphicsMapFlagsWriteDiscard</span><span class="p">));</span>
<span class="w">    </span><span class="n">CUDA_CHECK</span><span class="p">(</span><span class="n">cudaGraphicsGLRegisterBuffer</span><span class="p">(</span>
<span class="w">        </span><span class="o">&amp;</span><span class="n">cuda_col_vbo_resource</span><span class="p">,</span><span class="w"> </span><span class="n">col_vbo</span><span class="p">,</span><span class="w"> </span><span class="n">cudaGraphicsMapFlagsWriteDiscard</span><span class="p">));</span>

<span class="w">    </span><span class="c1">// create VAO:</span>
<span class="w">    </span><span class="n">glGenVertexArrays</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">vao</span><span class="p">);</span>
<span class="w">    </span><span class="n">glBindVertexArray</span><span class="p">(</span><span class="n">vao</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// - bind position vbos</span>
<span class="w">    </span><span class="n">glBindBuffer</span><span class="p">(</span><span class="n">GL_ARRAY_BUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">x_vbo</span><span class="p">);</span>
<span class="w">    </span><span class="n">glVertexAttribPointer</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">GL_FLOAT</span><span class="p">,</span><span class="w"> </span><span class="n">GL_FALSE</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="n">glEnableVertexAttribArray</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="w">    </span><span class="n">glBindBuffer</span><span class="p">(</span><span class="n">GL_ARRAY_BUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">y_vbo</span><span class="p">);</span>
<span class="w">    </span><span class="n">glVertexAttribPointer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">GL_FLOAT</span><span class="p">,</span><span class="w"> </span><span class="n">GL_FALSE</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="n">glEnableVertexAttribArray</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="w">    </span><span class="n">glBindBuffer</span><span class="p">(</span><span class="n">GL_ARRAY_BUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">z_vbo</span><span class="p">);</span>
<span class="w">    </span><span class="n">glVertexAttribPointer</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">GL_FLOAT</span><span class="p">,</span><span class="w"> </span><span class="n">GL_FALSE</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="n">glEnableVertexAttribArray</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// - bind colour vbo</span>
<span class="w">    </span><span class="n">glBindBuffer</span><span class="p">(</span><span class="n">GL_ARRAY_BUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">col_vbo</span><span class="p">);</span>
<span class="w">    </span><span class="n">glVertexAttribPointer</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">GL_FLOAT</span><span class="p">,</span><span class="w"> </span><span class="n">GL_FALSE</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="n">glEnableVertexAttribArray</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>

<span class="w">    </span><span class="n">glBindVertexArray</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="n">GUI</span><span class="o">::</span><span class="n">destroy_and_deregister_buffers</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// de-register VBO from use by CUDA</span>
<span class="w">    </span><span class="n">CUDA_CHECK</span><span class="p">(</span><span class="n">cudaGraphicsUnregisterResource</span><span class="p">(</span><span class="n">cuda_x_vbo_resource</span><span class="p">));</span>
<span class="w">    </span><span class="n">CUDA_CHECK</span><span class="p">(</span><span class="n">cudaGraphicsUnregisterResource</span><span class="p">(</span><span class="n">cuda_y_vbo_resource</span><span class="p">));</span>
<span class="w">    </span><span class="n">CUDA_CHECK</span><span class="p">(</span><span class="n">cudaGraphicsUnregisterResource</span><span class="p">(</span><span class="n">cuda_z_vbo_resource</span><span class="p">));</span>

<span class="w">    </span><span class="n">CUDA_CHECK</span><span class="p">(</span><span class="n">cudaGraphicsUnregisterResource</span><span class="p">(</span><span class="n">cuda_col_vbo_resource</span><span class="p">));</span>

<span class="w">    </span><span class="c1">// delete VBO and VAO buffers</span>
<span class="w">    </span><span class="n">glDeleteBuffers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x_vbo</span><span class="p">);</span>
<span class="w">    </span><span class="n">glDeleteBuffers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">y_vbo</span><span class="p">);</span>
<span class="w">    </span><span class="n">glDeleteBuffers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">z_vbo</span><span class="p">);</span>

<span class="w">    </span><span class="n">glDeleteBuffers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">col_vbo</span><span class="p">);</span>
<span class="w">    </span><span class="n">glDeleteVertexArrays</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">vao</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="n">GUI</span><span class="o">::</span><span class="n">map_buffers</span><span class="p">(</span><span class="n">Particles</span><span class="o">&amp;</span><span class="w"> </span><span class="n">state</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// map the buffer for CUDA access</span>
<span class="w">    </span><span class="n">pos_cuda_mapped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>

<span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">_num_bytes</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// map x position buffer and update xx pointer in state</span>
<span class="w">    </span><span class="n">CUDA_CHECK</span><span class="p">(</span><span class="n">cudaGraphicsMapResources</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cuda_x_vbo_resource</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span>
<span class="w">    </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">x_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">CUDA_CHECK</span><span class="p">(</span><span class="n">cudaGraphicsResourceGetMappedPointer</span><span class="p">(</span>
<span class="w">        </span><span class="p">(</span><span class="kt">void</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">x_ptr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">_num_bytes</span><span class="p">,</span><span class="w"> </span><span class="n">cuda_x_vbo_resource</span><span class="p">));</span>
<span class="w">    </span><span class="n">state</span><span class="p">.</span><span class="n">xx</span><span class="p">.</span><span class="n">update_raw_ptr</span><span class="p">(</span><span class="n">x_ptr</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// map y position buffer and update xy pointer in state</span>
<span class="w">    </span><span class="n">CUDA_CHECK</span><span class="p">(</span><span class="n">cudaGraphicsMapResources</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cuda_y_vbo_resource</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span>
<span class="w">    </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">y_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">CUDA_CHECK</span><span class="p">(</span><span class="n">cudaGraphicsResourceGetMappedPointer</span><span class="p">(</span>
<span class="w">        </span><span class="p">(</span><span class="kt">void</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">y_ptr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">_num_bytes</span><span class="p">,</span><span class="w"> </span><span class="n">cuda_y_vbo_resource</span><span class="p">));</span>
<span class="w">    </span><span class="n">state</span><span class="p">.</span><span class="n">xy</span><span class="p">.</span><span class="n">update_raw_ptr</span><span class="p">(</span><span class="n">y_ptr</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// map z position buffer and update xz pointer in state</span>
<span class="w">    </span><span class="n">CUDA_CHECK</span><span class="p">(</span><span class="n">cudaGraphicsMapResources</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cuda_z_vbo_resource</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span>
<span class="w">    </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">z_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">CUDA_CHECK</span><span class="p">(</span><span class="n">cudaGraphicsResourceGetMappedPointer</span><span class="p">(</span>
<span class="w">        </span><span class="p">(</span><span class="kt">void</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">z_ptr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">_num_bytes</span><span class="p">,</span><span class="w"> </span><span class="n">cuda_z_vbo_resource</span><span class="p">));</span>
<span class="w">    </span><span class="n">state</span><span class="p">.</span><span class="n">xz</span><span class="p">.</span><span class="n">update_raw_ptr</span><span class="p">(</span><span class="n">z_ptr</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">GUI</span><span class="o">::</span><span class="n">map_colour_buffer</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// map the buffer for CUDA access</span>
<span class="w">    </span><span class="n">col_cuda_mapped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="n">CUDA_CHECK</span><span class="p">(</span><span class="n">cudaGraphicsMapResources</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cuda_col_vbo_resource</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span>

<span class="w">    </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">colours</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">num_bytes</span><span class="p">;</span>
<span class="w">    </span><span class="n">CUDA_CHECK</span><span class="p">(</span><span class="n">cudaGraphicsResourceGetMappedPointer</span><span class="p">(</span>
<span class="w">        </span><span class="p">(</span><span class="kt">void</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">colours</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">num_bytes</span><span class="p">,</span><span class="w"> </span><span class="n">cuda_col_vbo_resource</span><span class="p">));</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">colours</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="n">GUI</span><span class="o">::</span><span class="n">unmap_buffers</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">pos_cuda_mapped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="n">CUDA_CHECK</span><span class="p">(</span><span class="n">cudaGraphicsUnmapResources</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cuda_x_vbo_resource</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span>
<span class="w">    </span><span class="n">CUDA_CHECK</span><span class="p">(</span><span class="n">cudaGraphicsUnmapResources</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cuda_y_vbo_resource</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span>
<span class="w">    </span><span class="n">CUDA_CHECK</span><span class="p">(</span><span class="n">cudaGraphicsUnmapResources</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cuda_z_vbo_resource</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="n">GUI</span><span class="o">::</span><span class="n">unmap_colour_buffer</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">col_cuda_mapped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="n">CUDA_CHECK</span><span class="p">(</span><span class="n">cudaGraphicsUnmapResources</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cuda_col_vbo_resource</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="n">GUI</span><span class="o">::</span><span class="n">resize_mapped_buffers</span><span class="p">(</span><span class="n">uint</span><span class="w"> </span><span class="n">N_new</span><span class="p">,</span><span class="w"> </span><span class="n">Particles</span><span class="o">&amp;</span><span class="w"> </span><span class="n">state</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// require that the positions buffer be currently mapped for usage by CUDA,</span>
<span class="w">    </span><span class="c1">// such that a CUDA-valid pointer can be returned after remapping</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">pos_cuda_mapped</span><span class="p">)</span>
<span class="w">        </span><span class="n">throw</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span>
<span class="w">            </span><span class="s">&quot;resize_mapped_buffers called on an unmapped buffer&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// unmap the buffer</span>
<span class="w">    </span><span class="n">unmap_buffers</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// clean up CUDA binding of vbo</span>
<span class="w">    </span><span class="n">destroy_and_deregister_buffers</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// set the new number of particles</span>
<span class="w">    </span><span class="n">this</span><span class="o">-&gt;</span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N_new</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// create the buffer with the correct, new size</span>
<span class="w">    </span><span class="n">create_and_register_buffers</span><span class="p">(</span><span class="n">N_new</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// map the buffer for use by CUDA and return the resulting pointer</span>
<span class="w">    </span><span class="n">map_buffers</span><span class="p">(</span><span class="n">state</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="n">GUI</span><span class="o">::</span><span class="n">initialize_buffers</span><span class="p">(</span><span class="n">Particles</span><span class="o">&amp;</span><span class="w"> </span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">map_buffers</span><span class="p">(</span><span class="n">state</span><span class="p">);</span><span class="w"> </span><span class="p">};</span>

<span class="kt">bool</span><span class="w"> </span><span class="nf">GUI::update_or_exit</span><span class="p">(</span><span class="n">Particles</span><span class="o">&amp;</span><span class="w"> </span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Scene</span><span class="w"> </span><span class="n">scene</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// declare a static variable for measuring how much time has passed since</span>
<span class="w">    </span><span class="c1">// the last re-render</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">prev</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">steady_clock</span><span class="o">::</span><span class="n">now</span><span class="p">()</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="c1">// update the fps counter of the simulation, regardless of whether the GUI</span>
<span class="w">    </span><span class="c1">// will re-render in this invocation</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">steady_clock</span><span class="o">::</span><span class="n">now</span><span class="p">()</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="n">sim_fps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span><span class="n">ms</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">now</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">prev</span><span class="p">);</span>
<span class="w">    </span><span class="n">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">now</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// if an  exit was requested by the GUI, pass that information on to the</span>
<span class="w">    </span><span class="c1">// caller and return immediately</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">exit_requested</span><span class="p">.</span><span class="n">load</span><span class="p">())</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// if the `timer` thread has not deemed it time to re-render yet, also</span>
<span class="w">    </span><span class="c1">// return early but with return value indicating no exit from the</span>
<span class="w">    </span><span class="c1">// application</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">fps_gui_sim_coupled</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">should_render</span><span class="p">.</span><span class="n">load</span><span class="p">())</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// otherwise, render:</span>

<span class="w">    </span><span class="c1">// first, fill the colour buffer</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">use_per_particle_colour</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">col_buf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">map_colour_buffer</span><span class="p">();</span>
<span class="w">        </span><span class="c1">// display velocities</span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">vx</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="n">vx</span><span class="p">.</span><span class="n">ptr</span><span class="p">()</span><span class="w"> </span><span class="p">};</span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">vy</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="n">vy</span><span class="p">.</span><span class="n">ptr</span><span class="p">()</span><span class="w"> </span><span class="p">};</span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">vz</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="n">vz</span><span class="p">.</span><span class="n">ptr</span><span class="p">()</span><span class="w"> </span><span class="p">};</span>
<span class="w">        </span><span class="n">thrust</span><span class="o">::</span><span class="n">transform</span><span class="p">(</span><span class="n">thrust</span><span class="o">::</span><span class="n">counting_iterator</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
<span class="w">            </span><span class="n">thrust</span><span class="o">::</span><span class="n">counting_iterator</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="n">vx</span><span class="p">.</span><span class="n">size</span><span class="p">()),</span>
<span class="w">            </span><span class="n">thrust</span><span class="o">::</span><span class="n">device_pointer_cast</span><span class="p">(</span><span class="n">col_buf</span><span class="p">),</span>
<span class="w">            </span><span class="p">[</span><span class="n">vx</span><span class="p">,</span><span class="w"> </span><span class="n">vy</span><span class="p">,</span><span class="w"> </span><span class="n">vz</span><span class="p">]</span><span class="w"> </span><span class="kt">__device__</span><span class="p">(</span>
<span class="w">                </span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">norm</span><span class="p">(</span><span class="n">v3</span><span class="p">(</span><span class="n">vx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">vy</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">vz</span><span class="p">[</span><span class="n">i</span><span class="p">]));</span><span class="w"> </span><span class="p">});</span>

<span class="w">        </span><span class="n">unmap_colour_buffer</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// then unmap the particle position buffer from CUDA so that OpenGL can use</span>
<span class="w">    </span><span class="c1">// it as a VBO for drawing spheres</span>
<span class="w">    </span><span class="n">unmap_buffers</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// now the main update to the GUI can happen, drawing to the screen,</span>
<span class="w">    </span><span class="c1">// processing inputs and handling interaction with UI elements</span>
<span class="w">    </span><span class="n">update</span><span class="p">(</span><span class="n">scene</span><span class="p">.</span><span class="n">h</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// before returning, remap the positions buffers and reflect that change in</span>
<span class="w">    </span><span class="c1">// the particle state in case the pointer has changed</span>
<span class="w">    </span><span class="n">map_buffers</span><span class="p">(</span><span class="n">state</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// finally, reset the flag for needing to render until the timer sets it</span>
<span class="w">    </span><span class="c1">// again to throttle rendering to the `target_fps`</span>
<span class="w">    </span><span class="n">should_render</span><span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// the program should not be exited right now, return true</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">GUI::update</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">h</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// process inputs</span>
<span class="w">    </span><span class="n">glfw_process_input</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// clear the screen</span>
<span class="w">    </span><span class="n">glClear</span><span class="p">(</span><span class="n">GL_COLOR_BUFFER_BIT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">GL_DEPTH_BUFFER_BIT</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// OpenGL rendering commands</span>
<span class="w">    </span><span class="n">glUseProgram</span><span class="p">(</span><span class="n">shader_program</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// send uniforms</span>
<span class="w">    </span><span class="n">glUniformMatrix4fv</span><span class="p">(</span><span class="n">glGetUniformLocation</span><span class="p">(</span><span class="n">shader_program</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;view&quot;</span><span class="p">),</span><span class="w"> </span><span class="c1">// location</span>
<span class="w">        </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="c1">// count</span>
<span class="w">        </span><span class="n">GL_FALSE</span><span class="p">,</span><span class="w"> </span><span class="c1">// transpose</span>
<span class="w">        </span><span class="n">glm</span><span class="o">::</span><span class="n">value_ptr</span><span class="p">(</span><span class="n">view</span><span class="p">)</span><span class="w"> </span><span class="c1">// value</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="n">glUniformMatrix4fv</span><span class="p">(</span><span class="n">glGetUniformLocation</span><span class="p">(</span><span class="n">shader_program</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;proj&quot;</span><span class="p">),</span><span class="w"> </span><span class="c1">// location</span>
<span class="w">        </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="c1">// count</span>
<span class="w">        </span><span class="n">GL_FALSE</span><span class="p">,</span><span class="w"> </span><span class="c1">// transpose</span>
<span class="w">        </span><span class="n">glm</span><span class="o">::</span><span class="n">value_ptr</span><span class="p">(</span><span class="n">proj</span><span class="p">)</span><span class="w"> </span><span class="c1">// value</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="n">glUniform2f</span><span class="p">(</span><span class="n">glGetUniformLocation</span><span class="p">(</span><span class="n">shader_program</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;viewport&quot;</span><span class="p">),</span><span class="w"> </span><span class="c1">// location</span>
<span class="w">        </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">_window_width</span><span class="p">,</span><span class="w"> </span><span class="c1">// value 1</span>
<span class="w">        </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">_window_height</span><span class="w"> </span><span class="c1">// value 2</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="n">glUniform1f</span><span class="p">(</span><span class="n">glGetUniformLocation</span><span class="p">(</span><span class="n">shader_program</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;radius&quot;</span><span class="p">),</span><span class="w"> </span><span class="c1">// location</span>
<span class="w">        </span><span class="n">h</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2.f</span><span class="w"> </span><span class="c1">// value</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="n">glUniform1i</span><span class="p">(</span><span class="n">glGetUniformLocation</span><span class="p">(</span><span class="n">shader_program</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;use_colour&quot;</span><span class="p">),</span><span class="w"> </span><span class="c1">// location</span>
<span class="w">        </span><span class="n">use_per_particle_colour</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="c1">// value</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="n">glUniform1f</span><span class="p">(</span>
<span class="w">        </span><span class="n">glGetUniformLocation</span><span class="p">(</span><span class="n">shader_program</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;colour_scale&quot;</span><span class="p">),</span><span class="w"> </span><span class="c1">// location</span>
<span class="w">        </span><span class="mf">1.</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">colour_scale</span><span class="w"> </span><span class="c1">// value</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="n">glUniform1i</span><span class="p">(</span>
<span class="w">        </span><span class="n">glGetUniformLocation</span><span class="p">(</span><span class="n">shader_program</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;colour_map_selector&quot;</span><span class="p">),</span><span class="w"> </span><span class="c1">// location</span>
<span class="w">        </span><span class="n">colour_map_selector</span><span class="w"> </span><span class="c1">// value</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="n">glBindVertexArray</span><span class="p">(</span><span class="n">vao</span><span class="p">);</span>

<span class="w">    </span><span class="n">glDrawArrays</span><span class="p">(</span><span class="n">GL_POINTS</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">);</span>
<span class="w">    </span><span class="n">glBindVertexArray</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// poll for window events</span>
<span class="w">    </span><span class="n">glfwPollEvents</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">glfwWindowShouldClose</span><span class="p">(</span><span class="n">window</span><span class="p">))</span>
<span class="w">        </span><span class="n">exit_requested</span><span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// update ImGUI</span>
<span class="w">    </span><span class="n">imgui_draw</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// swap back and front buffers</span>
<span class="w">    </span><span class="n">glfwSwapBuffers</span><span class="p">(</span><span class="n">window</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">GUI::imgui_draw</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// update the FPS count in the window title using the ImGui framerate</span>
<span class="w">    </span><span class="c1">// counter</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">max_fps_str_size</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">fps_str</span><span class="p">[</span><span class="n">max_fps_str_size</span><span class="p">];</span>
<span class="w">    </span><span class="n">snprintf</span><span class="p">(</span><span class="n">fps_str</span><span class="p">,</span><span class="w"> </span><span class="n">max_fps_str_size</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;REYN | FPS %5.1f / %5.1f&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">io</span><span class="o">-&gt;</span><span class="n">Framerate</span><span class="p">,</span><span class="w"> </span><span class="n">sim_fps</span><span class="p">);</span>
<span class="w">    </span><span class="n">glfwSetWindowTitle</span><span class="p">(</span><span class="n">window</span><span class="p">,</span><span class="w"> </span><span class="n">fps_str</span><span class="p">);</span>

<span class="w">    </span><span class="n">ImGui_ImplOpenGL3_NewFrame</span><span class="p">();</span>
<span class="w">    </span><span class="n">ImGui_ImplGlfw_NewFrame</span><span class="p">();</span>
<span class="w">    </span><span class="n">ImGui</span><span class="o">::</span><span class="n">NewFrame</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// // docking setup</span>
<span class="w">    </span><span class="c1">// ImGuiID id;</span>
<span class="w">    </span><span class="c1">// ImGui::DockSpaceOverViewport(id, ImGui::GetMainViewport(),</span>
<span class="w">    </span><span class="c1">// ImGuiDockNodeFlags_PassthruCentralNode);</span>

<span class="w">    </span><span class="c1">// use custom font</span>
<span class="w">    </span><span class="n">ImGui</span><span class="o">::</span><span class="n">PushFont</span><span class="p">(</span><span class="n">font</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// start of contents ~~~~~</span>
<span class="w">    </span><span class="n">ImGui</span><span class="o">::</span><span class="n">Begin</span><span class="p">(</span><span class="s">&quot;SETTINGS&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">ImGui</span><span class="o">::</span><span class="n">Text</span><span class="p">(</span><span class="s">&quot;GUI interval %.3fms (%.1f FPS)&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1000.0f</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">io</span><span class="o">-&gt;</span><span class="n">Framerate</span><span class="p">,</span>
<span class="w">        </span><span class="n">io</span><span class="o">-&gt;</span><span class="n">Framerate</span><span class="p">);</span>
<span class="w">    </span><span class="n">ImGui</span><span class="o">::</span><span class="n">Text</span><span class="p">(</span><span class="s">&quot;SIM interval %.3fms (%.1f FPS)&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1000.0f</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">sim_fps</span><span class="p">,</span><span class="w"> </span><span class="n">sim_fps</span><span class="p">);</span>
<span class="w">    </span><span class="n">ImGui</span><span class="o">::</span><span class="n">Checkbox</span><span class="p">(</span><span class="s">&quot;Run GUI and SIM at same rate&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">fps_gui_sim_coupled</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ImGui</span><span class="o">::</span><span class="n">Button</span><span class="p">(</span><span class="s">&quot;Exit&quot;</span><span class="p">))</span>
<span class="w">        </span><span class="n">exit_requested</span><span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ImGui</span><span class="o">::</span><span class="n">InputFloat</span><span class="p">(</span><span class="s">&quot;Base Camera Radius&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">radius_init</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">))</span>
<span class="w">        </span><span class="n">update_view</span><span class="p">();</span>
<span class="w">    </span><span class="n">ImGui</span><span class="o">::</span><span class="n">Checkbox</span><span class="p">(</span><span class="s">&quot;Use per-particle colours&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">use_per_particle_colour</span><span class="p">);</span>
<span class="w">    </span><span class="n">ImGui</span><span class="o">::</span><span class="n">InputFloat</span><span class="p">(</span>
<span class="w">        </span><span class="s">&quot;Colour mapping maximum value&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">colour_scale</span><span class="p">,</span><span class="w"> </span><span class="mf">1.f</span><span class="p">,</span><span class="w"> </span><span class="mf">5.f</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%.0f&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">ImGui</span><span class="o">::</span><span class="n">Combo</span><span class="p">(</span><span class="s">&quot;Colour map&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">colour_map_selector</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Spectral</span><span class="se">\0</span><span class="s">CB-RdYiBu&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// end of contents ~~~~~~~</span>

<span class="w">    </span><span class="n">ImGui</span><span class="o">::</span><span class="n">PopFont</span><span class="p">();</span>
<span class="w">    </span><span class="n">ImGui</span><span class="o">::</span><span class="n">End</span><span class="p">();</span>
<span class="w">    </span><span class="n">ImGui</span><span class="o">::</span><span class="n">Render</span><span class="p">();</span>
<span class="w">    </span><span class="n">ImGui_ImplOpenGL3_RenderDrawData</span><span class="p">(</span><span class="n">ImGui</span><span class="o">::</span><span class="n">GetDrawData</span><span class="p">());</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">ConfigFlags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">ImGuiConfigFlags_ViewportsEnable</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">GLFWwindow</span><span class="o">*</span><span class="w"> </span><span class="n">backup_current_context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glfwGetCurrentContext</span><span class="p">();</span>
<span class="w">        </span><span class="n">ImGui</span><span class="o">::</span><span class="n">UpdatePlatformWindows</span><span class="p">();</span>
<span class="w">        </span><span class="n">ImGui</span><span class="o">::</span><span class="n">RenderPlatformWindowsDefault</span><span class="p">();</span>
<span class="w">        </span><span class="n">glfwMakeContextCurrent</span><span class="p">(</span><span class="n">backup_current_context</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="n">GUI</span><span class="o">::~</span><span class="n">GUI</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// join the timer thread to prevent leaks</span>
<span class="w">    </span><span class="n">timer</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// unmap, unregister VBOs from CUDA and delete them</span>
<span class="w">    </span><span class="n">unmap_buffers</span><span class="p">();</span>
<span class="w">    </span><span class="n">destroy_and_deregister_buffers</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// clearn up OpenGL</span>
<span class="w">    </span><span class="n">glDeleteProgram</span><span class="p">(</span><span class="n">shader_program</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// clean up GLFW</span>
<span class="w">    </span><span class="n">glfwTerminate</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="file_src_gui.cuh.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">File gui.cuh</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="file_src_gui.cu.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">File gui.cu</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Julian Karrer
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=46bd48cc"></script>
    <script src="../_static/collapsible-lists/js/CollapsibleLists.compressed.js?v=73120307"></script>
    <script src="../_static/collapsible-lists/js/apply-collapsible-lists.js?v=660e4f45"></script>
    </body>
</html>