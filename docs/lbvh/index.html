<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="../_static/icon.png" sizes="1024x1024" rel="icon" type="image/png"><link rel="index" title="Index" href="../genindex.html"><link rel="search" title="Search" href="../search.html"><link rel="next" title="C++ Documentation" href="../api/library_root.html"><link rel="prev" title="Neighbour Search Benchmarks" href="../benchmarks/index.html">
        <link rel="prefetch" href="../_static/icon.png" as="image">

    <!-- Generated with Sphinx 8.2.3 and Furo 2025.09.25 -->
        <title>LBVH - REYN documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=580074bf" />
    <link rel="stylesheet" type="text/css" href="../_static/collapsible-lists/css/tree_view.css?v=a885cde7" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">REYN  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/icon.png" alt="Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../samplings/index.html">Relaxed Boundary Sampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../benchmarks/index.html">Neighbour Search Benchmarks</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">LBVH</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api/library_root.html">C++ Documentation</a><input aria-label="Toggle navigation of C++ Documentation" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/structAABB.html">Struct AABB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/structBitmapFileHeader.html">Struct BitmapFileHeader</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/structBitmapInformationHeader.html">Struct BitmapInformationHeader</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/structBoundary.html">Struct Boundary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/structBoundarySamples.html">Struct BoundarySamples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/structChildNode.html">Struct ChildNode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/structCullPredicate.html">Struct CullPredicate</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/structDeviceBuffer_1_1ExternallyManagedBuffer.html">Struct DeviceBuffer::ExternallyManagedBuffer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/structDeviceLBVH.html">Struct DeviceLBVH</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/structDeviceMesh.html">Struct DeviceMesh</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/structGenJitter.html">Struct GenJitter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/structGUI_1_1DragState.html">Struct GUI::DragState</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/structhas__templated__call__operator.html">Template Struct has_templated_call_operator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/structhas__templated__call__operator_3_01T_00_01Tuple_00_01std_1_1void__t_3_01decltype_07std_1_1de6d0a016993f2cbb04a203bdb7b2b88.html">Template Struct has_templated_call_operator&lt; T, Tuple, std::void_t&lt; decltype(std::declval&lt; T &gt;, ().template operator()&lt; Tuple &gt;, (std::declval&lt; Tuple const &amp; &gt;, ())) &gt; &gt;</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/structInsidePredicate.html">Template Struct InsidePredicate</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/structLaunchInsidePredicate.html">Template Struct LaunchInsidePredicate</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/structMaybeSorted.html">Template Struct MaybeSorted</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/structMaybeSorted_3_01Resort_1_1no_01_4.html">Template Struct MaybeSorted&lt; Resort::no &gt;</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/structMaybeSorted_3_01Resort_1_1yes_01_4.html">Template Struct MaybeSorted&lt; Resort::yes &gt;</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/structMesh.html">Struct Mesh</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/structMortonCodeExtender.html">Struct MortonCodeExtender</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/structMortonCodeGenerator.html">Struct MortonCodeGenerator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/structProjectionLaunchFunctor.html">Template Struct ProjectionLaunchFunctor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/structRuntimeTemplateSelectList.html">Template Struct RuntimeTemplateSelectList</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/structRuntimeTemplateSelectList_3_01Launch_00_01Last_01_4.html">Template Struct RuntimeTemplateSelectList&lt; Launch, Last &gt;</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/structUniformGrid.html">Template Struct UniformGrid</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/classB3.html">Class B3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/classC2.html">Class C2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/classCOS.html">Class COS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/classDeviceBuffer.html">Template Class DeviceBuffer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/classGUI.html">Class GUI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/classIISPH.html">Template Class IISPH</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/classKernel.html">Template Class Kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/classLBVH.html">Class LBVH</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/classLog.html">Class Log</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/classParticles.html">Class Particles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/classPCISPH.html">Template Class PCISPH</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/classScene.html">Class Scene</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/classSESPH.html">Template Class SESPH</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/classUniformGridBuilder.html">Class UniformGridBuilder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/classW6.html">Class W6</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/file_src_buffer.cuh.html">File buffer.cuh</a><input aria-label="Toggle navigation of File buffer.cuh" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/program_listing_file_src_buffer.cuh.html">Program Listing for File buffer.cuh</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/file_src_timestep_cfl.cu.html">File cfl.cu</a><input aria-label="Toggle navigation of File cfl.cu" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/program_listing_file_src_timestep_cfl.cu.html">Program Listing for File cfl.cu</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/file_src_timestep_cfl.cuh.html">File cfl.cuh</a><input aria-label="Toggle navigation of File cfl.cuh" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/program_listing_file_src_timestep_cfl.cuh.html">Program Listing for File cfl.cuh</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/file_src_common.h.html">File common.h</a><input aria-label="Toggle navigation of File common.h" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/program_listing_file_src_common.h.html">Program Listing for File common.h</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/file_src_utils_dispatch.cuh.html">File dispatch.cuh</a><input aria-label="Toggle navigation of File dispatch.cuh" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/program_listing_file_src_utils_dispatch.cuh.html">Program Listing for File dispatch.cuh</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/file_src_utils_geometry.cuh.html">File geometry.cuh</a><input aria-label="Toggle navigation of File geometry.cuh" class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/program_listing_file_src_utils_geometry.cuh.html">Program Listing for File geometry.cuh</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/file_src_gui.cu.html">File gui.cu</a><input aria-label="Toggle navigation of File gui.cu" class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/program_listing_file_src_gui.cu.html">Program Listing for File gui.cu</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/file_src_gui.cuh.html">File gui.cuh</a><input aria-label="Toggle navigation of File gui.cuh" class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/program_listing_file_src_gui.cuh.html">Program Listing for File gui.cuh</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/file_src_solvers_IISPH.cu.html">File IISPH.cu</a><input aria-label="Toggle navigation of File IISPH.cu" class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/program_listing_file_src_solvers_IISPH.cu.html">Program Listing for File IISPH.cu</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/file_src_solvers_IISPH.cuh.html">File IISPH.cuh</a><input aria-label="Toggle navigation of File IISPH.cuh" class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/program_listing_file_src_solvers_IISPH.cuh.html">Program Listing for File IISPH.cuh</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/file_src_io_bmp_writer.h.html">File io_bmp_writer.h</a><input aria-label="Toggle navigation of File io_bmp_writer.h" class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/program_listing_file_src_io_bmp_writer.h.html">Program Listing for File io_bmp_writer.h</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/file_src_kernels.cu.html">File kernels.cu</a><input aria-label="Toggle navigation of File kernels.cu" class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/program_listing_file_src_kernels.cu.html">Program Listing for File kernels.cu</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/file_src_kernels.cuh.html">File kernels.cuh</a><input aria-label="Toggle navigation of File kernels.cuh" class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/program_listing_file_src_kernels.cuh.html">Program Listing for File kernels.cuh</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/file_src_datastructure_lbvh.cu.html">File lbvh.cu</a><input aria-label="Toggle navigation of File lbvh.cu" class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/program_listing_file_src_datastructure_lbvh.cu.html">Program Listing for File lbvh.cu</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/file_src_datastructure_lbvh.cuh.html">File lbvh.cuh</a><input aria-label="Toggle navigation of File lbvh.cuh" class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/program_listing_file_src_datastructure_lbvh.cuh.html">Program Listing for File lbvh.cuh</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/file_src_scene_loader.cpp.html">File loader.cpp</a><input aria-label="Toggle navigation of File loader.cpp" class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/program_listing_file_src_scene_loader.cpp.html">Program Listing for File loader.cpp</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/file_src_scene_loader.h.html">File loader.h</a><input aria-label="Toggle navigation of File loader.h" class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/program_listing_file_src_scene_loader.h.html">Program Listing for File loader.h</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/file_src_log.h.html">File log.h</a><input aria-label="Toggle navigation of File log.h" class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/program_listing_file_src_log.h.html">Program Listing for File log.h</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/file_src_main.cu.html">File main.cu</a><input aria-label="Toggle navigation of File main.cu" class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/program_listing_file_src_main.cu.html">Program Listing for File main.cu</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/file_src_particles.cu.html">File particles.cu</a><input aria-label="Toggle navigation of File particles.cu" class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" role="switch" type="checkbox"/><label for="toctree-checkbox-21"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/program_listing_file_src_particles.cu.html">Program Listing for File particles.cu</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/file_src_particles.cuh.html">File particles.cuh</a><input aria-label="Toggle navigation of File particles.cuh" class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" role="switch" type="checkbox"/><label for="toctree-checkbox-22"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/program_listing_file_src_particles.cuh.html">Program Listing for File particles.cuh</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/file_src_solvers_PCISPH.cu.html">File PCISPH.cu</a><input aria-label="Toggle navigation of File PCISPH.cu" class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" role="switch" type="checkbox"/><label for="toctree-checkbox-23"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/program_listing_file_src_solvers_PCISPH.cu.html">Program Listing for File PCISPH.cu</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/file_src_solvers_PCISPH.cuh.html">File PCISPH.cuh</a><input aria-label="Toggle navigation of File PCISPH.cuh" class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" role="switch" type="checkbox"/><label for="toctree-checkbox-24"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/program_listing_file_src_solvers_PCISPH.cuh.html">Program Listing for File PCISPH.cuh</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/file_src_scene_ply_io.cu.html">File ply_io.cu</a><input aria-label="Toggle navigation of File ply_io.cu" class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" role="switch" type="checkbox"/><label for="toctree-checkbox-25"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/program_listing_file_src_scene_ply_io.cu.html">Program Listing for File ply_io.cu</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/file_src_scene_ply_io.cuh.html">File ply_io.cuh</a><input aria-label="Toggle navigation of File ply_io.cuh" class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" role="switch" type="checkbox"/><label for="toctree-checkbox-26"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/program_listing_file_src_scene_ply_io.cuh.html">Program Listing for File ply_io.cuh</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/file_src_scene_sample_boundary.cu.html">File sample_boundary.cu</a><input aria-label="Toggle navigation of File sample_boundary.cu" class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" role="switch" type="checkbox"/><label for="toctree-checkbox-27"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/program_listing_file_src_scene_sample_boundary.cu.html">Program Listing for File sample_boundary.cu</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/file_src_scene_sample_boundary.cuh.html">File sample_boundary.cuh</a><input aria-label="Toggle navigation of File sample_boundary.cuh" class="toctree-checkbox" id="toctree-checkbox-28" name="toctree-checkbox-28" role="switch" type="checkbox"/><label for="toctree-checkbox-28"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/program_listing_file_src_scene_sample_boundary.cuh.html">Program Listing for File sample_boundary.cuh</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/file_src_scene_scene.cu.html">File scene.cu</a><input aria-label="Toggle navigation of File scene.cu" class="toctree-checkbox" id="toctree-checkbox-29" name="toctree-checkbox-29" role="switch" type="checkbox"/><label for="toctree-checkbox-29"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/program_listing_file_src_scene_scene.cu.html">Program Listing for File scene.cu</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/file_src_scene_scene.cuh.html">File scene.cuh</a><input aria-label="Toggle navigation of File scene.cuh" class="toctree-checkbox" id="toctree-checkbox-30" name="toctree-checkbox-30" role="switch" type="checkbox"/><label for="toctree-checkbox-30"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/program_listing_file_src_scene_scene.cuh.html">Program Listing for File scene.cuh</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/file_src_solvers_SESPH.cu.html">File SESPH.cu</a><input aria-label="Toggle navigation of File SESPH.cu" class="toctree-checkbox" id="toctree-checkbox-31" name="toctree-checkbox-31" role="switch" type="checkbox"/><label for="toctree-checkbox-31"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/program_listing_file_src_solvers_SESPH.cu.html">Program Listing for File SESPH.cu</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/file_src_solvers_SESPH.cuh.html">File SESPH.cuh</a><input aria-label="Toggle navigation of File SESPH.cuh" class="toctree-checkbox" id="toctree-checkbox-32" name="toctree-checkbox-32" role="switch" type="checkbox"/><label for="toctree-checkbox-32"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/program_listing_file_src_solvers_SESPH.cuh.html">Program Listing for File SESPH.cuh</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/file_src_solvers_solver.cu.html">File solver.cu</a><input aria-label="Toggle navigation of File solver.cu" class="toctree-checkbox" id="toctree-checkbox-33" name="toctree-checkbox-33" role="switch" type="checkbox"/><label for="toctree-checkbox-33"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/program_listing_file_src_solvers_solver.cu.html">Program Listing for File solver.cu</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/file_src_solvers_solver.cuh.html">File solver.cuh</a><input aria-label="Toggle navigation of File solver.cuh" class="toctree-checkbox" id="toctree-checkbox-34" name="toctree-checkbox-34" role="switch" type="checkbox"/><label for="toctree-checkbox-34"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/program_listing_file_src_solvers_solver.cuh.html">Program Listing for File solver.cuh</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/file_src_datastructure_uniformgrid.cu.html">File uniformgrid.cu</a><input aria-label="Toggle navigation of File uniformgrid.cu" class="toctree-checkbox" id="toctree-checkbox-35" name="toctree-checkbox-35" role="switch" type="checkbox"/><label for="toctree-checkbox-35"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/program_listing_file_src_datastructure_uniformgrid.cu.html">Program Listing for File uniformgrid.cu</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/file_src_datastructure_uniformgrid.cuh.html">File uniformgrid.cuh</a><input aria-label="Toggle navigation of File uniformgrid.cuh" class="toctree-checkbox" id="toctree-checkbox-36" name="toctree-checkbox-36" role="switch" type="checkbox"/><label for="toctree-checkbox-36"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/program_listing_file_src_datastructure_uniformgrid.cuh.html">Program Listing for File uniformgrid.cuh</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/file_src_utils_vector.cuh.html">File vector.cuh</a><input aria-label="Toggle navigation of File vector.cuh" class="toctree-checkbox" id="toctree-checkbox-37" name="toctree-checkbox-37" role="switch" type="checkbox"/><label for="toctree-checkbox-37"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/program_listing_file_src_utils_vector.cuh.html">Program Listing for File vector.cuh</a></li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/lbvh/index.md.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section class="tex2jax_ignore mathjax_ignore" id="lbvh">
<h1>LBVH<a class="headerlink" href="#lbvh" title="Link to this heading">¶</a></h1>
<p>In order to implement “closest point to triangular mesh” queries and similar, an LBVH is implemented, the test for which generates the LBVH visualized in the following section.</p>
<p>The implementation follows <a class="reference external" href="https://research.nvidia.com/sites/default/files/pubs/2012-06_Maximizing-Parallelism-in/karras2012hpg_paper.pdf">“Maximizing Parallelism in the Construction of BVHs,
Octrees, and k-d Trees”</a> by Tero Karras and the accompanying blog post <a class="reference external" href="https://developer.nvidia.com/blog/thinking-parallel-part-iii-tree-construction-gpu/">Thinking Parallel, Part III: Tree Construction on the GPU</a>, and comparison with <a class="reference external" href="https://github.com/ToruNiina/lbvh/tree/master">Toru Niina’s implementation</a> during debugging.</p>
<section id="visualization">
<h2>Visualization<a class="headerlink" href="#visualization" title="Link to this heading">¶</a></h2>
<p>For the Stanford dragon model, an LBVH is built, its leaf and internal nodes visualized and “closest point on mesh” queries are tested by projecting randomly sampled points onto the mesh.</p>
<div class="checkbox-container">
    <div>
        <input type="checkbox" id="show_leaf" name="Show Leaf Nodes" class="input-elem">
            <span class="input-label">Show Leaf Nodes</span>
        </input>
    </div>
    <div>
        <input type="checkbox" id="show_internal" name="Show Internal Nodes" class="input-elem">
            <span class="input-label">Show Internal Nodes</span>
        </input>
    </div>
    <div>
        <input type="checkbox" id="show_mesh" name="Show Mesh" checked class="input-elem">
            <span class="input-label">Show Mesh</span>
        </input>
    </div>
    <div>
        <input type="checkbox" id="show_original" name="Show Points" checked class="input-elem">
            <span class="input-label">Show Original Points</span>
        </input>
    </div>
    <div>
        <input type="checkbox" id="show_projected" name="Show Projected Points" checked class="input-elem">
            <span class="input-label">Show Projected Points</span>
        </input>
    </div>
    <div>
        <input type="checkbox" id="show_connections" name="Show Connections" checked class="input-elem">
            <span class="input-label">Show Connections</span>
        </input>
    </div>
</div>
<div id="lbvhboxes"></div>
</section>
<section id="implementation-details">
<h2>Implementation Details<a class="headerlink" href="#implementation-details" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Instead of storing the binary radix tree as an array of nodes, a SoA layout was preferred with <code class="docutils literal notranslate"><span class="pre">children_l</span></code> and <code class="docutils literal notranslate"><span class="pre">children_r</span></code> buffers that each contain, bitpacked into a single 32bit unsigned integer, the index of the corresponding child node and a 1 bit flag in the LSB indicating if the child is a leaf node or not. This saves bandwdth during the memory-bound traversal</p></li>
<li><p>If primitives are resorted in Morton-order, no object IDs are required since the index of a leaf node may point directly into the underlying primtive buffer</p></li>
<li><p>Traversal uses the minimum squared distance to the AABB (<code class="docutils literal notranslate"><span class="pre">min(maxi,</span> <span class="pre">max(mini,</span> <span class="pre">p))</span> <span class="pre">-</span> <span class="pre">p</span></code> component-wise for AABB <code class="docutils literal notranslate"><span class="pre">mini,maxi</span></code>, then dot product with itself, see “Nearest Neighbor Queries” by [Roussopoulos, Kelley, Vincent]) to cull the search tree AND get an optimistic distance estimate for branch ordering, which is crucial for performance (put further child on the stack first -&gt; traverse the closer child first -&gt; more nodes can potentially be culled since the best result so far gets better faster)</p></li>
<li><p>Using <code class="docutils literal notranslate"><span class="pre">uint32_t</span></code> Morton codes with tie-breaking using primitive indices or directly baking the primitive index into the least significant 32 bits of a <code class="docutils literal notranslate"><span class="pre">uint64_t</span></code> makes no difference in terms of peak memory consumption, since the buffer can be released before the much larger AABB buffers are filled. However, using <code class="docutils literal notranslate"><span class="pre">uint64_t</span></code> is more robust in implementation since uniqueness of keys can easily be tested when debugging, which is important since Karras’ algorithm <em><strong>REQUIRES</strong></em> unique codes or correct tiebreaking. Using incorrect tiebreaking or non-unique keys can produce subtle bugs that are a nightmare to debug.</p></li>
<li><p>Factoring out the BVH traversal into a higher order function means that the same code can be reused for variations of “closest point to mesh” queries by providing different <code class="docutils literal notranslate"><span class="pre">__device__</span></code> lambdas. The squared distance to the closest point on the mesh must always be returned, but a second tuple entry can hold a quantity of interest, like the projected point itself <code class="docutils literal notranslate"><span class="pre">(uint32_t</span> <span class="pre">idx)-&gt;thrust::tuple&lt;float,</span> <span class="pre">float3&gt;</span></code>. Similarly <code class="docutils literal notranslate"><span class="pre">(uint32_t</span> <span class="pre">idx)-&gt;thrust::tuple&lt;float,</span> <span class="pre">bool&gt;</span></code> can then be used for checking if the query point is inside or outside the mesh by projecting the vector from query point to closest point on the mesh onto the normal of the corresponding triangle using a triple product <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">·</span> <span class="pre">(b</span> <span class="pre">⨉</span> <span class="pre">c)</span></code> (if winding order is consistent). This can be used to e.g. initialize fluid within some watertight mesh.</p></li>
<li><p>Using recursion on variadic template arguments like a list construction in a functional language, a number of possible stack sizes for the fixed-size stack in BVH traversal can be given, and the specialization that gives the smallest stack size that fits the tree can be selected at runtime. Usage then looks like <code class="docutils literal notranslate"><span class="pre">RuntimeTemplateSelectList&lt;ProjectionLaunchFunctor,</span> <span class="pre">4,</span> <span class="pre">8,</span> <span class="pre">16,</span> <span class="pre">24,</span> <span class="pre">32,</span> <span class="pre">48,</span> <span class="pre">64,</span> <span class="pre">128&gt;::dispatch(tree_height,</span> <span class="pre">...args);</span></code></p></li>
</ul>
<script type="importmap">
{
    "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.181.0/build/three.module.js",
        "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.181.0/examples/jsm/"
    }
}
</script>
<style>
#lbvhboxes{  
    width: 100%;
    height: max(500px, 80vh);
    position: relative;
}
#lbvhboxes > div{  
    position: absolute !important;
}
.checkbox-container{
    border: 2px solid var(--color-code-foreground);
    padding:20px;  
    margin: 20px;
    border-radius:5px;  
    display: flex;
    flex-direction: row;  
    width: calc(100% - 80px);
    flex-wrap: wrap;
}
.input-label{
    margin-left:10px;
}
.input-elem{
    width: 30px; 
    height: 30px;
    margin-left: 10px;
}
</style>
<script type="module">
    import * as THREE from 'three';

    import Stats from 'three/addons/libs/stats.module.js';
    import { OBJLoader } from 'three/addons/loaders/OBJLoader.js'
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

    let container = document.getElementById("lbvhboxes")
    let camera = new THREE.PerspectiveCamera(50, 0.5*container.clientWidth / container.clientHeight, 0.01, 100);
    camera.position.z = 5;
    let controls = new OrbitControls(camera, container)
    controls.enableDamping = true

    let stats = new Stats();

    let scene, renderer;
    let onWindowResize = () => {
        camera.aspect = container.clientWidth / container.clientHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(container.clientWidth, container.clientHeight);
    }

    scene = new THREE.Scene();

    const ambientLight = new THREE.AmbientLight(0xffffff, 1)
    scene.add(ambientLight)
    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.9)
    directionalLight.position.set(1, 0.25, 0)
    scene.add(directionalLight)

    const bvh_int_material = new THREE.MeshBasicMaterial({
        color: "royalblue", 
        opacity: 0.1, 
        transparent: true, 
        depthTest: true,
        side: THREE.DoubleSide
    })
    const bvh_leaf_material = new THREE.MeshStandardMaterial({
        color: "white", 
        opacity: 0.5, 
        transparent: true, 
        depthTest: true,
        side: THREE.DoubleSide
    })


    // instanced AABB rendering: leafs
    const res = await fetch('../_static/lbvh_leafs.bin');
    const buf = await res.arrayBuffer();
    const leafs = new Float32Array(buf);
    const N = leafs.length / 6
    const leaf_instance_mesh = new THREE.InstancedMesh(
        new THREE.BoxGeometry(1,1,1), 
        bvh_leaf_material, 
        N
    );
    scene.add(leaf_instance_mesh);
    const dummy = new THREE.Object3D();
    for (let i = 0; i < N; i++) {
        const px = leafs[i*6 + 0];
        const py = leafs[i*6 + 1];
        const pz = leafs[i*6 + 2];
        const sx = leafs[i*6 + 3];
        const sy = leafs[i*6 + 4];
        const sz = leafs[i*6 + 5];
        dummy.position.set(px, py, pz);
        dummy.scale.set(sx, sy, sz);
        dummy.updateMatrix();
        leaf_instance_mesh.setMatrixAt(i, dummy.matrix);
    }

    // instanced AABB rendering: internal nodes
    const res_int = await fetch('../_static/lbvh_internals.bin');
    const buf_int = await res_int.arrayBuffer();
    const internals = new Float32Array(buf_int);
    const N_int = leafs.length / 6
    const internal_instance_mesh = new THREE.InstancedMesh(
        new THREE.BoxGeometry(1,1,1), 
        bvh_int_material, 
        N
    );
    // console.log(internals, N_int)
    scene.add(internal_instance_mesh);
    for (let i = 0; i < N_int; i++) {
        const px = internals[i*6 + 0];
        const py = internals[i*6 + 1];
        const pz = internals[i*6 + 2];
        const sx = internals[i*6 + 3];
        const sy = internals[i*6 + 4];
        const sz = internals[i*6 + 5];
        dummy.position.set(px, py, pz);
        dummy.scale.set(sx, sy, sz);
        dummy.updateMatrix();
        internal_instance_mesh.setMatrixAt(i, dummy.matrix);
    }

    // show point clouds
    const points_to_scene = async (points_path, colour, size=0.02) => {
        const res_pp = await fetch(points_path);
        const buf_pp = await res_pp.arrayBuffer();
        const proj_points_buf = new Float32Array(buf_pp);
        const N_points = proj_points_buf.length / 3
        const proj_points_geo = new THREE.BufferGeometry();
        const proj_verts = []
        for (let i = 0; i < N_points; i++) {
            proj_verts.push(
                proj_points_buf[i*3+0],
                proj_points_buf[i*3+1],
                proj_points_buf[i*3+2]
            );
        }
        proj_points_geo.setAttribute( 'position', new THREE.Float32BufferAttribute( proj_verts, 3 ) );
        const proj_points_mat = new THREE.PointsMaterial({
                color: colour,
                size: size,
                sizeAttenuation: true
            });
        return new THREE.Points(proj_points_geo, proj_points_mat)
    }
    const points_proj = await points_to_scene('../_static/points_proj.bin', "orange", 0.05)
    const points_orig = await points_to_scene('../_static/points_orig.bin', "white")
    scene.add(points_proj);
    scene.add(points_orig);

    // add connecting lines
    const res_lines_orig = await fetch('../_static/points_orig.bin');
    const buf_lines_orig = await res_lines_orig.arrayBuffer();
    const orig_buf = new Float32Array(buf_lines_orig);
    const res_lines_proj = await fetch('../_static/points_proj.bin');
    const buf_lines_proj = await res_lines_proj.arrayBuffer();
    const proj_buf = new Float32Array(buf_lines_proj);
    const N_lines = Math.min(orig_buf.length, proj_buf.length) / 3;
    const line_positions = new Float32Array(N_lines * 6); // 2 vertices per segment
    for (let i = 0; i < N_lines; i++) {
        // original point
        line_positions[i*6 + 0] = orig_buf[i*3 + 0];
        line_positions[i*6 + 1] = orig_buf[i*3 + 1];
        line_positions[i*6 + 2] = orig_buf[i*3 + 2];
        // projected point
        line_positions[i*6 + 3] = proj_buf[i*3 + 0];
        line_positions[i*6 + 4] = proj_buf[i*3 + 1];
        line_positions[i*6 + 5] = proj_buf[i*3 + 2];
    }

    const connections_geo = new THREE.BufferGeometry();
    connections_geo.setAttribute('position', new THREE.Float32BufferAttribute(line_positions, 3));
    const connections_mat = new THREE.LineBasicMaterial({
        color: 'yellow',
        transparent: true,
        opacity: 0.9,
        depthTest: true
    });
    const connection_lines = new THREE.LineSegments(connections_geo, connections_mat);
    scene.add(connection_lines);


    // load mesh
    const material =  new THREE.MeshStandardMaterial({color: "white", opacity: 0.5, transparent: true, side: THREE.DoubleSide})
    const loader = new OBJLoader();
    const model = await loader.loadAsync( '../_static/dragon.obj'  );
    scene.add( model );

    let animate = () => {
        controls.update()
        renderer.render(scene, camera);
        stats.update();
        leaf_instance_mesh.visible = document.getElementById("show_leaf")?.checked
        internal_instance_mesh.visible = document.getElementById("show_internal")?.checked
        model.visible = document.getElementById("show_mesh")?.checked
        points_proj.visible = document.getElementById("show_projected")?.checked
        points_orig.visible = document.getElementById("show_original")?.checked
        connection_lines.visible = document.getElementById("show_connections")?.checked
    }
    renderer = new THREE.WebGLRenderer({
        logarithmicDepthBuffer: true 
    });
    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.setSize(container.clientWidth, container.clientHeight);
    renderer.setAnimationLoop(animate);
    window.addEventListener('resize', onWindowResize);
    container.appendChild(renderer.domElement);
    onWindowResize()

    // show stats
    container.appendChild(stats.dom);
</script>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../api/library_root.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">C++ Documentation</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../benchmarks/index.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Neighbour Search Benchmarks</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Julian Karrer
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">LBVH</a><ul>
<li><a class="reference internal" href="#visualization">Visualization</a></li>
<li><a class="reference internal" href="#implementation-details">Implementation Details</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=46bd48cc"></script>
    <script src="../_static/collapsible-lists/js/CollapsibleLists.compressed.js?v=73120307"></script>
    <script src="../_static/collapsible-lists/js/apply-collapsible-lists.js?v=660e4f45"></script>
    </body>
</html>